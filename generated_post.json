{
  "title": "Serverless DNSï¼šé‡æ–°æ€è€ƒDNSè§£æçš„äº‘åŸç”Ÿæ–¹æ¡ˆ ğŸš€âš¡",
  "content": "Serverless DNSï¼šé‡æ–°æ€è€ƒDNSè§£æçš„äº‘åŸç”Ÿæ–¹æ¡ˆ ğŸš€âš¡\n\n<h2 id=\"the-dns-dilemma\">DNSçš„å›°å¢ƒä¸æœºé‡</h2>\n\n<p>è¿˜è®°å¾—ä¸Šæ¬¡å› ä¸ºDNSæ±¡æŸ“è€Œæ— æ³•è®¿é—®æŸä¸ªç½‘ç«™æ—¶çš„æ²®ä¸§å—ï¼Ÿæˆ–è€…å› ä¸ºDNSæœåŠ¡å™¨å“åº”ç¼“æ…¢å¯¼è‡´ç½‘é¡µåŠ è½½å¡é¡¿çš„ä½“éªŒï¼Ÿä¼ ç»Ÿçš„DNSè§£æè™½ç„¶æ˜¯æˆ‘ä»¬æ¯å¤©ä¸Šç½‘çš„åŸºç¡€è®¾æ–½ï¼Œå´å¾€å¾€å› ä¸ºä¸­å¿ƒåŒ–æ¶æ„ã€éšç§æ³„éœ²ã€æ€§èƒ½ç“¶é¢ˆç­‰é—®é¢˜è€Œå¤‡å—è¯Ÿç—…ã€‚</p>\n\n<p>å°±åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œ<strong>serverless-dns</strong>é¡¹ç›®æ¨ªç©ºå‡ºä¸–ï¼Œå®ƒæ‰¿è¯ºè¦ç”¨äº‘åŸç”Ÿçš„æ–¹å¼é‡æ–°å‘æ˜DNSè§£æã€‚è¿™ä¸ªé¡¹ç›®ä¸ä»…æ”¯æŒéƒ¨ç½²åˆ°Cloudflare Workersã€Deno Deployç­‰ç°ä»£è¾¹ç¼˜è®¡ç®—å¹³å°ï¼Œè¿˜è‡´åŠ›äºæä¾›æ›´å¿«ã€æ›´å®‰å…¨ã€æ›´éšç§çš„DNSè§£ææœåŠ¡ã€‚ğŸ¯</p>\n\n<h2 id=\"architecture-design\">æ¶æ„è®¾è®¡ï¼šè¾¹ç¼˜è®¡ç®—çš„å®Œç¾æ¼”ç»</h2>\n\n<p>serverless-dnsçš„æ ¸å¿ƒè®¾è®¡ç†å¿µå¯ä»¥ç”¨ä¸€ä¸ªè¯æ¦‚æ‹¬ï¼š<strong>å»ä¸­å¿ƒåŒ–</strong>ã€‚ä¸ä¼ ç»Ÿçš„é›†ä¸­å¼DNSè§£æå™¨ä¸åŒï¼Œå®ƒå……åˆ†åˆ©ç”¨äº†è¾¹ç¼˜è®¡ç®—å¹³å°çš„åˆ†å¸ƒå¼ç‰¹æ€§ã€‚</p>\n\n<h3 id=\"multi-platform-support\">å¤šå¹³å°æ”¯æŒç­–ç•¥</h3>\n\n<p>é¡¹ç›®æœ€ä»¤äººå°è±¡æ·±åˆ»çš„æ˜¯å®ƒå¯¹å¤šä¸ªserverlesså¹³å°çš„æ”¯æŒï¼š</p>\n\n<ul>\n<li><strong>Cloudflare Workers</strong>ï¼šå…¨çƒè¾¹ç¼˜ç½‘ç»œï¼Œè¶…ä½å»¶è¿Ÿ</li>\n<li><strong>Deno Deploy</strong>ï¼šåŸºäºDenoè¿è¡Œæ—¶ï¼Œå®‰å…¨æ€§æé«˜</li>\n<li><strong>Fastly</strong>ï¼šé«˜æ€§èƒ½è¾¹ç¼˜è®¡ç®—å¹³å°</li>\n<li><strong>Fly.io</strong>ï¼šè½»é‡çº§å…¨å±€éƒ¨ç½²</li>\n</ul>\n\n<p>è¿™ç§å¤šå¹³å°ç­–ç•¥ä¸ä»…æé«˜äº†å¯ç”¨æ€§ï¼Œè¿˜é¿å…äº†ä¾›åº”å•†é”å®šé—®é¢˜ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„å¹³å°ã€‚ğŸ› ï¸</p>\n\n<h3 id=\"request-flow\">è¯·æ±‚å¤„ç†æµç¨‹</h3>\n\n<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå…¸å‹çš„DNSæŸ¥è¯¢åœ¨serverless-dnsä¸­æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š</p>\n\n<pre><code class=\"language-javascript\">\n// ç®€åŒ–çš„è¯·æ±‚å¤„ç†æµç¨‹\nasync function handleDnsRequest(request) {\n  // 1. è§£æDNSæŸ¥è¯¢\n  const query = parseDnsQuery(request);\n  \n  // 2. åº”ç”¨è¿‡æ»¤è§„åˆ™ï¼ˆå¹¿å‘Šæ‹¦æˆªã€æ¶æ„ç½‘ç«™ç­‰ï¼‰\n  const filtered = applyFilters(query);\n  if (filtered.blocked) {\n    return createBlockResponse();\n  }\n  \n  // 3. æŸ¥è¯¢ä¸Šæ¸¸DNSè§£æå™¨\n  const upstreamResponse = await queryUpstream(query);\n  \n  // 4. åº”ç”¨ç¼“å­˜ç­–ç•¥\n  const cachedResponse = await checkCache(upstreamResponse);\n  \n  // 5. è¿”å›DNSå“åº”\n  return createDnsResponse(cachedResponse);\n}\n</code></pre>\n\n<h2 id=\"key-technologies\">å…³é”®æŠ€æœ¯å®ç°ç»†èŠ‚</h2>\n\n<h3 id=\"dns-over-https\">DNS-over-HTTPS (DoH) æ”¯æŒ</h3>\n\n<p>serverless-dnsåŸç”Ÿæ”¯æŒDoHåè®®ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„DNSæŸ¥è¯¢éƒ½é€šè¿‡åŠ å¯†çš„HTTPSè¿æ¥è¿›è¡Œï¼Œæœ‰æ•ˆé˜²æ­¢äº†ä¸­é—´äººæ”»å‡»å’ŒæŸ¥è¯¢åŠ«æŒã€‚</p>\n\n<pre><code class=\"language-javascript\">\n// DoHæŸ¥è¯¢ç¤ºä¾‹\nasync function dohQuery(domain, type = 'A') {\n  const url = <code>https://dns.example.com/dns-query?name=${domain}&type=${type}</code>;\n  const response = await fetch(url, {\n    headers: {\n      'Accept': 'application/dns-json'\n    }\n  });\n  return await response.json();\n}\n</code></pre>\n\n<h3 id=\"filtering-system\">æ™ºèƒ½è¿‡æ»¤ç³»ç»Ÿ</h3>\n\n<p>é¡¹ç›®å†…ç½®äº†å¼ºå¤§çš„è¿‡æ»¤ç³»ç»Ÿï¼Œæ”¯æŒï¼š</p>\n\n<ul>\n<li>å¹¿å‘ŠåŸŸåæ‹¦æˆª</li>\n<li>æ¶æ„è½¯ä»¶ç½‘ç«™é˜»æ­¢</li>\n<li>è·Ÿè¸ªå™¨å±è”½</li>\n<li>è‡ªå®šä¹‰é»‘ç™½åå•</li>\n</ul>\n\n<p>è¿‡æ»¤è§„åˆ™ä½¿ç”¨é«˜æ•ˆçš„åŒ¹é…ç®—æ³•ï¼Œç¡®ä¿åœ¨è¾¹ç¼˜ç¯å¢ƒä¸­çš„æ€§èƒ½è¡¨ç°ã€‚âš¡</p>\n\n<h2 id=\"performance-optimization\">æ€§èƒ½ä¼˜åŒ–ä¸è®¾è®¡äº®ç‚¹</h2>\n\n<h3 id=\"edge-caching\">è¾¹ç¼˜ç¼“å­˜ç­–ç•¥</h3>\n\n<p>serverless-dnså®ç°äº†æ™ºèƒ½çš„å¤šå±‚ç¼“å­˜ï¼š</p>\n\n<ul>\n<li><strong>å†…å­˜ç¼“å­˜</strong>ï¼šåœ¨workerå®ä¾‹ä¸­ç¼“å­˜çƒ­é—¨æŸ¥è¯¢</li>\n<li><strong>KVå­˜å‚¨</strong>ï¼šåˆ©ç”¨å¹³å°çš„é”®å€¼å­˜å‚¨è¿›è¡ŒæŒä¹…åŒ–ç¼“å­˜</li>\n<li><strong>TTLä¼˜åŒ–</strong>ï¼šæ ¹æ®DNSè®°å½•çš„TTLåŠ¨æ€è°ƒæ•´ç¼“å­˜ç­–ç•¥</li>\n</ul>\n\n<p>è¿™ç§ç¼“å­˜ç­–ç•¥ä½¿å¾—é‡å¤æŸ¥è¯¢çš„å“åº”æ—¶é—´å¯ä»¥é™ä½åˆ°æ¯«ç§’çº§åˆ«ã€‚ğŸš€</p>\n\n<h3 id=\"connection-reuse\">è¿æ¥å¤ç”¨ä¸å¹¶å‘å¤„ç†</h3>\n\n<p>é¡¹ç›®å……åˆ†åˆ©ç”¨äº†ç°ä»£JavaScriptçš„å¼‚æ­¥ç‰¹æ€§ï¼Œå®ç°äº†é«˜æ•ˆçš„å¹¶å‘å¤„ç†ï¼š</p>\n\n<pre><code class=\"language-javascript\">\n// å¹¶å‘å¤„ç†å¤šä¸ªä¸Šæ¸¸DNSæŸ¥è¯¢\nasync function queryMultipleUpstreams(queries) {\n  const promises = queries.map(query => \n    Promise.race([\n      queryUpstream1(query),\n      queryUpstream2(query),\n      timeout(5000) // 5ç§’è¶…æ—¶\n    ])\n  );\n  \n  return await Promise.allSettled(promises);\n}\n</code></pre>\n\n<h2 id=\"developer-experience\">å¼€å‘è€…ä½¿ç”¨ä½“éªŒ</h2>\n\n<h3 id=\"easy-deployment\">ä¸€é”®éƒ¨ç½²ä½“éªŒ</h3>\n\n<p>serverless-dnsæä¾›äº†æå…¶ç®€å•çš„éƒ¨ç½²æµç¨‹ã€‚ä»¥Cloudflare Workersä¸ºä¾‹ï¼š</p>\n\n<pre><code class=\"language-bash\">\n# å…‹éš†é¡¹ç›®\ngit clone https://github.com/serverless-dns/serverless-dns\ncd serverless-dns\n\n# å®‰è£…ä¾èµ–\nnpm install\n\n# é…ç½®wrangler\nnpx wrangler login\n\n# éƒ¨ç½²åˆ°Cloudflare Workers\nnpm run deploy\n</code></pre>\n\n<h3 id=\"configuration\">çµæ´»çš„é…ç½®ç³»ç»Ÿ</h3>\n\n<p>é¡¹ç›®æ”¯æŒä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œè®©å¼€å‘è€…å¯ä»¥è½»æ¾å®šåˆ¶DNSè§£æè¡Œä¸ºï¼š</p>\n\n<pre><code class=\"language-javascript\">\n// é…ç½®ç¤ºä¾‹\nconst config = {\n  upstreams: [\n    'https://cloudflare-dns.com/dns-query',\n    'https://dns.google/dns-query'\n  ],\n  filters: {\n    ads: true,\n    malware: true,\n    tracking: false\n  },\n  cache: {\n    ttl: 300, // 5åˆ†é’Ÿ\n    maxSize: 1000\n  }\n};\n</code></pre>\n\n<h2 id=\"real-world-scenarios\">å®é™…åº”ç”¨åœºæ™¯</h2>\n\n<p>serverless-dnsä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯æ¼”ç¤ºï¼Œå®ƒåœ¨å®é™…åœºæ™¯ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼š</p>\n\n<ul>\n<li><strong>ä¼ä¸šå†…ç½‘DNS</strong>ï¼šå¿«é€Ÿéƒ¨ç½²ä¼ä¸šå†…éƒ¨DNSè§£ææœåŠ¡</li>\n<li><strong>éšç§ä¿æŠ¤</strong>ï¼šé¿å…ISPç›‘æ§DNSæŸ¥è¯¢è®°å½•</li>\n<li><strong>å†…å®¹è¿‡æ»¤</strong>ï¼šä¸ºå®¶åº­æˆ–å­¦æ ¡ç½‘ç»œæä¾›å®‰å…¨ä¸Šç½‘ç¯å¢ƒ</li>\n<li><strong>ç ”å‘æµ‹è¯•</strong>ï¼šå¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒçš„DNSæœåŠ¡</li>\n</ul>\n\n<h2 id=\"technical-insights\">æŠ€æœ¯æ ˆæ€»ç»“ä¸å¯å‘</h2>\n\n<p>serverless-dnsé¡¹ç›®ç»™æˆ‘ä»¬å¸¦æ¥äº†å‡ ä¸ªé‡è¦çš„æŠ€æœ¯å¯å‘ï¼š</p>\n\n<p><strong>1. è¾¹ç¼˜è®¡ç®—çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</strong><br>\né¡¹ç›®å±•ç¤ºäº†å¦‚ä½•æ­£ç¡®åˆ©ç”¨è¾¹ç¼˜è®¡ç®—å¹³å°å¤„ç†I/Oå¯†é›†å‹ä»»åŠ¡ï¼ŒDNSè§£æçš„è½»é‡çº§è®¡ç®—ç‰¹æ€§ä¸è¾¹ç¼˜å¹³å°çš„å®šä½å®Œç¾å¥‘åˆã€‚</p>\n\n<p><strong>2. å¤šå¹³å°å…¼å®¹æ€§è®¾è®¡</strong><br>\né€šè¿‡æŠ½è±¡å±‚è®¾è®¡ï¼Œé¡¹ç›®èƒ½å¤Ÿåœ¨ä¸åŒçš„serverlesså¹³å°ä¸Šè¿è¡Œï¼Œè¿™ç§æ¶æ„æ€è·¯å€¼å¾—å­¦ä¹ ã€‚</p>\n\n<p><strong>3. æ€§èƒ½ä¸åŠŸèƒ½çš„å¹³è¡¡</strong><br>\nåœ¨æœ‰é™çš„è¾¹ç¼˜è®¡ç®—èµ„æºä¸‹ï¼Œé¡¹ç›®å®ç°äº†åŠŸèƒ½ä¸°å¯Œæ€§å’Œæ€§èƒ½çš„æœ€ä½³å¹³è¡¡ã€‚</p>\n\n<p><strong>4. å¼€æºåä½œçš„åŠ›é‡</strong><br>\né¡¹ç›®æ´»è·ƒçš„ç¤¾åŒºè´¡çŒ®å±•ç¤ºäº†å¼€æºæ¨¡å¼åœ¨åŸºç¡€è®¾æ–½è½¯ä»¶ä¸­çš„å¼ºå¤§ç”Ÿå‘½åŠ›ã€‚</p>\n\n<h2 id=\"conclusion\">ç»“è¯­ï¼šDNSçš„æœªæ¥åœ¨è¾¹ç¼˜</h2>\n\n<p>serverless-dnsä¸ä»…ä»…æ˜¯ä¸€ä¸ªDNSè§£æå™¨ï¼Œå®ƒä»£è¡¨äº†åŸºç¡€è®¾æ–½è½¯ä»¶å‘è¾¹ç¼˜è®¡ç®—è¿ç§»çš„è¶‹åŠ¿ã€‚é€šè¿‡å°†ä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–æœåŠ¡æ‹†è§£åˆ°å…¨çƒåˆ†å¸ƒçš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å¾—æ›´å¥½çš„æ€§èƒ½ã€æ›´å¼ºçš„å¯é æ€§å’Œæ›´é«˜çš„éšç§ä¿æŠ¤ã€‚</p>\n\n<p>æ­£å¦‚é¡¹ç›®READMEä¸­æ‰€è¯´ï¼š<em>\"RethinkDNS\"</em>â€”â€”è¿™ç¡®å®æ˜¯å¯¹ä¼ ç»ŸDNSçš„ä¸€æ¬¡å½»åº•é‡æ–°æ€è€ƒã€‚å¯¹äºæ­£åœ¨å¯»æ‰¾ç°ä»£DNSè§£å†³æ–¹æ¡ˆçš„å¼€å‘è€…æ¥è¯´ï¼Œserverless-dnsç»å¯¹å€¼å¾—ä¸€è¯•ã€‚ğŸŒŸ</p>\n\n<p>é¡¹ç›®åœ°å€ï¼š<a href=\"https://github.com/serverless-dns/serverless-dns\">https://github.com/serverless-dns/serverless-dns</a></p>",
  "repo_info": {
    "name": "serverless-dns/serverless-dns",
    "url": "https://github.com/serverless-dns/serverless-dns",
    "desc": "The RethinkDNS resolver that deploys to Cloudflare Workers, Deno Deploy, Fastly, and Fly.io",
    "stars": "2,862",
    "date": "2025-11-12"
  },
  "generated_at": "2025-11-12T00:35:40.713381"
}